<div class="admin-products-container">
  <!-- Header Section -->
  <div class="header-section">
    <h2>Products Management</h2>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateModal()" [disabled]="loading">
        <i class="fas fa-plus"></i> Add New Product
      </button>
      <button class="btn btn-success" (click)="exportToExcel()" [disabled]="loading || filteredProducts.length === 0">
        <i class="fas fa-download"></i> Export to Excel
      </button>
    </div>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="searchProducts()"
        placeholder="Search by product code or name..."
        class="search-input"
      >
      <i class="fas fa-search search-icon"></i>
    </div>
    <div class="results-count">
      Showing {{ filteredProducts.length }} of {{ products.length }} products
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i> Loading...
  </div>

  <!-- Products Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="products-table">
      <thead>
        <tr>
          <th>Product Code</th>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Min Quantity</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts" class="product-row">
          <td>{{ product.productCode }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.category }}</td>
          <td>${{ product.price | number:'1.2-2' }}</td>
          <td>{{ product.minimumQuantity }}</td>
          <td>
            <img *ngIf="product.imagePath" [src]="product.imagePath" alt="Product Image" class="product-image">
            <span *ngIf="!product.imagePath" class="no-image">No Image</span>
          </td>
          <td class="actions">
            <button class="btn btn-sm btn-info" (click)="openEditModal(product)" [disabled]="loading">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="openDeleteModal(product)" [disabled]="loading">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- No Products Message -->
    <div *ngIf="filteredProducts.length === 0 && !loading" class="no-products">
      <i class="fas fa-box-open"></i>
      <p>No products found</p>
      <button class="btn btn-primary" (click)="openCreateModal()">Add First Product</button>
    </div>
  </div>

  <!-- Create Product Modal -->
  <div *ngIf="showCreateModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Create New Product</h3>
        <button class="close-btn" (click)="closeModals()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createProduct()">
          <div class="form-group">
            <label for="productCode">Product Code *</label>
            <input 
              type="text" 
              id="productCode" 
              [(ngModel)]="productForm.productCode" 
              name="productCode"
              class="form-control"
              readonly
              placeholder="Auto-generated by system"
            >
            <small class="form-text text-muted">Product code will be automatically generated</small>
          </div>
          <div class="form-group">
            <label for="name">Product Name *</label>
            <input 
              type="text" 
              id="name" 
              [(ngModel)]="productForm.name" 
              name="name"
              class="form-control"
              required
            >
          </div>
          <div class="form-group">
            <label for="category">Category</label>
            <input 
              type="text" 
              id="category" 
              [(ngModel)]="productForm.category" 
              name="category"
              class="form-control"
            >
          </div>
          <div class="form-group">
            <label>Product Image</label>
            <div 
              class="image-upload-area"
              [class.drag-over]="dragOver"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
            >
              <div *ngIf="!imagePreview" class="upload-placeholder">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop an image here or click to browse</p>
                <input 
                  type="file" 
                  accept="image/*" 
                  (change)="onFileSelected($event)"
                  class="file-input"
                  #fileInput
                >
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="fileInput.click()">
                  Choose File
                </button>
              </div>
              <div *ngIf="imagePreview" class="image-preview">
                <img [src]="imagePreview" alt="Preview" class="preview-image">
                <button type="button" class="btn btn-danger btn-sm remove-btn" (click)="removeImage()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <small class="form-text text-muted">Supported formats: JPG, PNG, GIF. Max size: 5MB</small>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="price">Price *</label>
              <input 
                type="number" 
                id="price" 
                [(ngModel)]="productForm.price" 
                name="price"
                class="form-control"
                min="0"
                step="0.01"
                required
              >
            </div>
            <div class="form-group">
              <label for="minimumQuantity">Minimum Quantity</label>
              <input 
                type="number" 
                id="minimumQuantity" 
                [(ngModel)]="productForm.minimumQuantity" 
                name="minimumQuantity"
                class="form-control"
                min="0"
              >
            </div>
            <div class="form-group">
              <label for="discountRate">Discount Rate (%)</label>
              <input 
                type="number" 
                id="discountRate" 
                [(ngModel)]="productForm.discountRate" 
                name="discountRate"
                class="form-control"
                min="0"
                max="100"
              >
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeModals()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="loading">
              <i *ngIf="loading" class="fas fa-spinner fa-spin"></i>
              Create Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit Product</h3>
        <button class="close-btn" (click)="closeModals()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateProduct()">
          <div class="form-group">
            <label for="editProductCode">Product Code *</label>
            <input 
              type="text" 
              id="editProductCode" 
              [(ngModel)]="productForm.productCode" 
              name="productCode"
              class="form-control"
              required
            >
          </div>
          <div class="form-group">
            <label for="editName">Product Name *</label>
            <input 
              type="text" 
              id="editName" 
              [(ngModel)]="productForm.name" 
              name="name"
              class="form-control"
              required
            >
          </div>
          <div class="form-group">
            <label for="editCategory">Category</label>
            <input 
              type="text" 
              id="editCategory" 
              [(ngModel)]="productForm.category" 
              name="category"
              class="form-control"
            >
          </div>
          <div class="form-group">
            <label>Product Image</label>
            <div 
              class="image-upload-area"
              [class.drag-over]="dragOver"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
            >
              <div *ngIf="!imagePreview" class="upload-placeholder">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop an image here or click to browse</p>
                <input 
                  type="file" 
                  accept="image/*" 
                  (change)="onFileSelected($event)"
                  class="file-input"
                  #fileInputEdit
                >
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="fileInputEdit.click()">
                  Choose File
                </button>
              </div>
              <div *ngIf="imagePreview" class="image-preview">
                <img [src]="imagePreview" alt="Preview" class="preview-image">
                <button type="button" class="btn btn-danger btn-sm remove-btn" (click)="removeImage()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <small class="form-text text-muted">Supported formats: JPG, PNG, GIF. Max size: 5MB</small>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editPrice">Price *</label>
              <input 
                type="number" 
                id="editPrice" 
                [(ngModel)]="productForm.price" 
                name="price"
                class="form-control"
                min="0"
                step="0.01"
                required
              >
            </div>
            <div class="form-group">
              <label for="editMinimumQuantity">Minimum Quantity</label>
              <input 
                type="number" 
                id="editMinimumQuantity" 
                [(ngModel)]="productForm.minimumQuantity" 
                name="minimumQuantity"
                class="form-control"
                min="0"
              >
            </div>
            <div class="form-group">
              <label for="editDiscountRate">Discount Rate (%)</label>
              <input 
                type="number" 
                id="editDiscountRate" 
                [(ngModel)]="productForm.discountRate" 
                name="discountRate"
                class="form-control"
                min="0"
                max="100"
              >
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" (click)="closeModals()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="loading">
              <i *ngIf="loading" class="fas fa-spinner fa-spin"></i>
              Update Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Delete</h3>
        <button class="close-btn" (click)="closeModals()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the product <strong>{{ productToDelete?.name }}</strong>?</p>
        <p class="text-muted">This action cannot be undone.</p>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModals()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="deleteProduct()" [disabled]="loading">
          <i *ngIf="loading" class="fas fa-spinner fa-spin"></i>
          Delete Product
        </button>
      </div>
    </div>
  </div>
</div>
